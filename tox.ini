[tox]
envlist =
    tests
    linting
    type_check
    format
    dev     
    docs        
    test_packaging

skip_missing_interpreters = True
skipsdist = True

[testenv]
commands = python -m pip install --upgrade pip

[testenv:tests]
# the tests environment is called by the Github action that runs the unit tests
deps =
    -r requirements.txt
    pytest
    pytest-env
    pytest-cov
    vcrpy
    requests-mock
setenv = 
    PYTHONPATH = {toxinidir}/src

commands = python -m pytest --basetemp={envtmpdir} {posargs}



[testenv:linting]
# the linting environment runs pylint on the code base
deps =
    -r requirements.txt
    pylint
setenv = PYTHONPATH = {toxinidir}/src
commands =
    pylint apiclient

[testenv:type_check]
# the type_check environment checks the type hints using mypy
deps =
    -r requirements.txt
    mypy
    ; types-pytz
    ; types-python-dateutil
setenv = PYTHONPATH = {toxinidir}/src
commands =
    mypy --show-error-codes src/apiclient
    mypy --show-error-codes tests

[testenv:format]
# install isort and black and invoke them on the current folder
deps = 
    isort
    black
commands = 
    isort .
    black .

[testenv:docs]
deps =
    mkdocs
    mkdocstrings[python]
    mkdocs-material
    pymdown-extensions
    Pygments
commands =
    mkdocs build


[testenv:dev]
# the dev environment allow upgrading the requirements.txt via pip-compile
# a recent requirements.in is required!
deps =
    {[testenv:tests]deps}
    {[testenv:linting]deps}
    {[testenv:type_check]deps}
    {[testenv:format]deps}
    {[testenv:docs]deps}
    pip-tools
commands =
    pip-compile --upgrade requirements.in


[testenv:test_packaging]
skip_install = true
deps =
    build
    twine
commands =
    python -m build
    twine check dist/*
